---
import { Debug } from 'astro:components';
import BaseLayout from '../layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';
import Image from '../components/CloudImage.astro';

export async function getStaticPaths() {
  const years = await getCollection('years');
  return years.map(entry => ({
    params: { slug: entry.slug }, props: { entry },
  }));
}

const { entry } = Astro.props;
const { Content } = await entry.render();
const images = entry.data.images;
const movies = entry.data.movies;
---
<BaseLayout url={entry.data.url}>
  <div class="container">
    <header class="mb-3xl">
      <div>
        <a href="/" class="text-highlight relative z-10">Back</a>
      </div>
      <h1 class="type-full inline-flex gap-x-[0.2em] -translate-x-[0.05em]" style="--scaler:12.3cqw;">
        <span class="uppercase text-highlight" transition:name="siteTitle">Halloween</span>
        <span class="font-display text-primary" transition:name={entry.data.title}>{entry.data.title}</span>
      </h1>
    </header>
    { images && (
      <section class="mb-2xl">
        <h2 class="font-display uppercase text-highlight text-4xl">Did</h2>
        <ul class="masonry-grid w-[calc(100%_+_var(--space-s))] md:w-[calc(100%_+_var(--space-m))] lg:w-[calc(100%_+_var(--space-l))]">
          <div class="gutter-sizer w-s md:w-m lg:w-lg"></div>
          <div class="grid-sizer w-full md:w-[calc(50%_-_var(--space-m))] lg:w-[calc(33.3333%_-_var(--space-l))]"></div>
          { images.map((image) => 
            <li class="grid-item w-full md:w-[calc(50%_-_var(--space-m))] lg:w-[calc(33.3333%_-_var(--space-l))] mb-s lg:mb-xl">
              <Image
              url={image.url}
              width={image.width}
              height={image.height}
              />
            </li>
          )}
        </ul>  
      </section>
      <template id="zoom-template">
        <figure class="fixed inset-0 flex h-screen w-full z-100">
          <div id="zoom-container" class="w-full mx-auto h-[calc(100%_-_100px)]"></div>
        </figure>
      </template>
    ) }
    { movies && (
      <section class="mb-2xl">
        <h2 class="font-display uppercase text-highlight text-4xl">Watched</h2>
        <ul class="grid gap-m md:grid-cols-2 lg:grid-cols-3">
          { movies.map((movie) => 
            <li class="@container rounded bg-highlight text-secondary p-s">
              <div class="flex flex-col @[400px]:flex-row gap-s">
                { movie.poster && (
                  <Image
                  url={movie.poster}
                  width="600"
                  height="600"
                  effects='e_grayscale/e_brightness:10/e_contrast:level_-70,e_tint:100:140C10:E2703A/'
                  containerClasses="aspect-square @[400px]:basis-1/2"
                  imgClasses="object-cover h-full"
                  />
                )}
                <div class="@[400px]:basis-1/2">
                  <h2 class="text-xl leading-none"><a class="hover:text-secondary focus-visible:text-secondary" href={ movie.url }>{ movie.title }</a></h2>
                  <div class="text-sm">{ movie.year }</div>
                  <div class="text-base">{ movie.rating }</div>
                </div>
              </div>
            </li>
          )}
        </ul>  
      </section>
    ) }
    <div class="prose">
      <Content />
    </div>
  </div>
</BaseLayout>